@startuml SIM-LAB System - Role-Based Class Diagram

' Styling
skinparam classAttributeIconSize 0
skinparam backgroundColor #FEFEFE
skinparam class {
    BackgroundColor<<Actor>> LightGreen
    BorderColor<<Actor>> DarkGreen
    BackgroundColor<<Controller>> LightBlue
    BorderColor<<Controller>> DodgerBlue
    BackgroundColor<<Service>> LightYellow
    BorderColor<<Service>> Orange
    BackgroundColor<<Model>> LightCyan
    BorderColor<<Model>> DarkCyan
}

' ===== ACTORS (USER ROLES) =====

abstract class User <<Actor>> {
    # id: bigint
    # name: string
    # email: string
    # password: string
    # role: enum
    --
    + login()
    + logout()
}

class RegularUser <<Actor>> {
    --
    **Permissions:**
    - View own bookings
    - Create bookings
    - View labs & assets
    - Create tickets
    - View schedule
}

class Staff <<Actor>> {
    --
    **Permissions:**
    - All User permissions
    - Manage visitors
    - Approve/Reject bookings
    - Update ticket status
    - Manage assets (CRUD)
    - Export visitor data
}

class Superadmin <<Actor>> {
    --
    **Permissions:**
    - All Staff permissions
    - Manage labs (CRUD)
    - Full system access
    - View all statistics
}

class GuestVisitor <<Actor>> {
    --
    **Permissions:**
    - Check-in (no login)
    - View public schedule
}

' Actor Inheritance
User <|-- RegularUser
User <|-- Staff
User <|-- Superadmin

' ===== CONTROLLERS =====

class AuthController <<Controller>> {
    + showLogin(): View
    + login(Request): RedirectResponse
    + logout(): RedirectResponse
}

class DashboardController <<Controller>> {
    + user(): View
    + staff(): View
    + superadmin(): View
}

class BookingController <<Controller>> {
    + index(): View
    + create(): View
    + store(Request): RedirectResponse
    + show(id): View
    + edit(id): View
    + update(Request, id): RedirectResponse
    + destroy(id): RedirectResponse
    + addVisitor(Request, booking): RedirectResponse
    + removeVisitor(booking, visitor): RedirectResponse
    + updateStatus(Request, booking): RedirectResponse
}

class LabController <<Controller>> {
    + index(): View
    + show(id): View
    + create(): View
    + store(Request): RedirectResponse
    + edit(id): View
    + update(Request, id): RedirectResponse
    + destroy(id): RedirectResponse
}

class AssetController <<Controller>> {
    + index(): View
    + show(id): View
    + create(): View
    + store(Request): RedirectResponse
    + edit(id): View
    + update(Request, id): RedirectResponse
    + destroy(id): RedirectResponse
}

class TicketController <<Controller>> {
    + index(): View
    + create(): View
    + store(Request): RedirectResponse
    + show(id): View
    + updateStatus(Request, ticket): RedirectResponse
}

class GuestVisitorController <<Controller>> {
    + showCheckInForm(): View
    + store(Request): RedirectResponse
}

class StaffDashboardController <<Controller>> {
    + index(Request): View
    + notifications(): View
    + visitorDetail(id): View
    + approve(id): RedirectResponse
    + reject(id): RedirectResponse
    + checkOutVisitor(id): RedirectResponse
    + exportExcel(): Download
    + exportPDF(): Download
}

class PublicScheduleController <<Controller>> {
    + index(): View
    + getBookings(): JsonResponse
}

' ===== MODELS =====

class Booking <<Model>> {
    - user_id
    - lab_id
    - start_time
    - end_time
    - purpose
    - status
}

class Lab <<Model>> {
    - name
    - capacity
    - location
}

class Asset <<Model>> {
    - lab_id
    - code
    - name
    - spec
    - condition
}

class Ticket <<Model>> {
    - user_id
    - asset_id
    - issue_description
    - status
}

class Visitor <<Model>> {
    - name
    - email
    - phone
    - purpose
    - person_to_meet
    - photo
    - status
    - approved_by
}

class BookingVisitor <<Model>> {
    - booking_id
    - name
    - email
    - phone
}

' ===== ROLE ACCESS TO CONTROLLERS =====

' All Users (Authenticated)
RegularUser --> AuthController : uses
Staff --> AuthController : uses
Superadmin --> AuthController : uses

RegularUser --> DashboardController : user()
Staff --> DashboardController : staff()
Superadmin --> DashboardController : superadmin()

' Guest Visitor (No Auth)
GuestVisitor --> GuestVisitorController : uses
GuestVisitor --> PublicScheduleController : uses

' User Access
RegularUser --> BookingController : CRUD own
RegularUser --> LabController : index(), show()
RegularUser --> AssetController : index(), show()
RegularUser --> TicketController : create, view

' Staff Access
Staff --> BookingController : CRUD + updateStatus()
Staff --> LabController : CRUD (with superadmin)
Staff --> AssetController : CRUD
Staff --> TicketController : full access + updateStatus()
Staff --> StaffDashboardController : full access

' Superadmin Access
Superadmin --> BookingController : full access
Superadmin --> LabController : full CRUD
Superadmin --> AssetController : full access
Superadmin --> TicketController : full access
Superadmin --> StaffDashboardController : full access

' ===== CONTROLLER TO MODEL =====

BookingController ..> Booking : manages
BookingController ..> BookingVisitor : manages
LabController ..> Lab : manages
AssetController ..> Asset : manages
TicketController ..> Ticket : manages
StaffDashboardController ..> Visitor : manages
GuestVisitorController ..> Visitor : creates

DashboardController ..> Booking : reads
DashboardController ..> Ticket : reads
DashboardController ..> Visitor : reads

' ===== NOTES =====

note right of GuestVisitor
  **No Authentication**
  Can access:
  - /visitor/check-in
  - /schedule (public)
end note

note right of RegularUser
  **Role: "user"**
  Dashboard: /user/dashboard
  
  Can:
  - Create/view own bookings
  - View labs & assets
  - Report tickets
  - View public schedule
  
  Cannot:
  - Approve bookings
  - Manage assets/labs
  - Access visitor system
end note

note right of Staff
  **Role: "staff"**
  Dashboard: /staff/dashboard
  
  Can do everything User can, plus:
  - Approve/reject bookings
  - Manage assets
  - Manage visitors (approve/reject)
  - Update ticket status
  - Export visitor reports
  - View visitor notifications
  
  Shares lab management with Superadmin
end note

note right of Superadmin
  **Role: "superadmin"**
  Dashboard: /superadmin/dashboard
  
  Can do everything Staff can, plus:
  - Full lab management (CRUD)
  - Access all system features
  - View aggregated statistics
  
  Highest privilege level
end note

note bottom of StaffDashboardController
  **Visitor Management**
  Access: Staff + Superadmin only
  
  Routes: /staff/visitors/*
  Features:
  - Dashboard with filters
  - Approve/Reject visitors
  - Check-in/Check-out
  - Export Excel/PDF
  - Notifications
end note

note bottom of BookingController
  **Access Levels:**
  - User: CRUD own bookings
  - Staff: + updateStatus()
  - Superadmin: Full access
  
  All can add/remove visitors
  to their bookings
end note

@enduml
